---
title: "P1-Inferencia"
author: "Nuria Oviedo, Marcos Lopez García"
date: "2024-10-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Ejercicio 1
```{r Librerias, message=FALSE, include = FALSE}
library(arulesCBA)
library(ggplot2)
library(summarytools)
library(tidyverse)
```

```{r Importar datos, include = FALSE}
data("Mushroom")
```

## Tamaño de los datos
```{r}
size <- dim(Mushroom)
n_obs <- size[1]
n_var <- size[2]
```
Este dataset, está compuesto de `r n_obs` observaciones y `r n_var` variables.

## Muestra del data set
Dado que tenemos un dataset con más de 1000 observaciones, hay que coger una muestra para hacer el análisis.

```{r}
set.seed(1234)
mushroom.muestra <- Mushroom[sample(1:n_obs, 1000, TRUE), ]
```

La muestra del dataset Mushroom es el siguiente:
`r mushroom.muestra`

## Tipo de variables
```{r}
# Varialbes discretas
var_discreta <- length(which(sapply(Mushroom, class) == 'factor'))

# Variables continuas
var_continuas <- length(which(sapply(Mushroom, class) != 'factor'))

# Categorías de las variables
lapply(Mushroom, function(x) if(is.factor(x) | is.character(x)) unique(as.character(x)) else NULL)

# Variables tipo texto
i = 0
for (var in sapply(Mushroom, is.character)){
  if (var == TRUE){
    i = i + 1
  }
} 
```

Estudiando el tipo de variables que tiene este dataset, sabemos que hay `r var_discreta` variables discretas y `r var_continuas` variables continuas. De todas estas variables hay `r i` variables tipo texto. Y las categorias de las variables son:  


## Variables irrelevantes
```{r echo = FALSE}
summary(Mushroom)
```

# Ejercicio 2
```{r}
summary(mushroom.muestra)
```

Dado que no hay variables continuas y todas son de tipo factor, solo podemos saber la fecuencia de la muestra:
```{r}
freq(mushroom.muestra)
```

Sin embargo hay varias varialbes que se pueden volver continuas. Como `RingNumber`o `RintType`. Tambien pueden ser booleanas como `Bruises`.
```{r}
mushroom.muestra$RingNumber.Numeric <- ifelse(mushroom.muestra$RingNumber == 'none', 0, 
                                       ifelse(mushroom.muestra$RingNumber == 'one', 1,
                                       ifelse(mushroom.muestra$RingNumber == 'two', 2, NA)))

mushroom.muestra$RingType.Numeric <- ifelse(mushroom.muestra$RingType == 'none', 0, 
                                     ifelse(mushroom.muestra$RingType == 'evanesent', 1,
                                     ifelse(mushroom.muestra$RingType == 'flaring', 2,
                                     ifelse(mushroom.muestra$RingType == 'large',3,
                                     ifelse(mushroom.muestra$RingType == 'pendant',4, NA)))))

mushroom.muestra$Bruises.bool <- ifelse(mushroom.muestra$Bruises == 'no', FALSE, 
                                       ifelse(mushroom.muestra$Bruises == 'bruise', TRUE, NA))
summary(mushroom.muestra)

```


## Ejercicio 3
Vamos a estudiar la variable `Spore` del dataset.
```{r}
tabla_frecuencias_type <- mushroom.muestra |>
  count(Spore) |>
  mutate(f = n / nrow(mushroom.muestra), N = cumsum(n), F = cumsum(f))
tabla_frecuencias_ordenada3 <- tabla_frecuencias_type |>
  arrange(desc(n))
tabla_frecuencias_ordenada3$F <- cumsum(tabla_frecuencias_ordenada3$f)
tabla_frecuencias_ordenada3$N <- cumsum(tabla_frecuencias_ordenada3$n)
print(tabla_frecuencias_ordenada3)
```

Por la tabla de frecuencias se puede ver que el color `buff` es el más frecuente, con una fracuencia de 0,187.

Resentando su frecuencia relativa obtenemos la siguiente tabla:
```{r}
mushroom.muestra  |> group_by(Spore) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), Spore = reorder(Spore, -Frequency)) |> ggplot(aes(x = Spore, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de Spore", x = "Color", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "olivedrab2", high = "burlywood3") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Se puede ver que el color `buff` tiene casi un 20% al igual que el color `pink`

```{r}
mushroom.muestra |>
  group_by(Spore) |>
  summarise(Frequency = n()) |>
  mutate(Spore = reorder(Spore, -Frequency)) |>
  ggplot(aes(x = Spore, y = Frequency)) +
  geom_bar(stat = "identity", aes(fill = Frequency)) +
  theme_bw() +
  labs(title = "Gráfico de barras con frecuencia absoluta de Spore",
       x = "Color",
       y = "Frecuencia absoluta") +
  scale_fill_gradient("Frecuencia", low = "olivedrab2", high = "burlywood3") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Al representar la frecuecia absoluta obtenermos el mismo resultado pero en cantidades, casi 200 hongos del color `buff` y `pink`. 

```{r}
ggplot(data = mushroom.muestra) +
  geom_bar(mapping = aes(x = Spore))
```


## Ejercicio 4
Como no tenermos varaibles continuas, voy a pasar a caracter la vaeiable de `GillColor`, los números que van con los distintos colores no tiene ninguna relacion, estan puestos por orden.

```{r}
mushroom.muestra$GillColor.numeric <- ifelse(mushroom.muestra$GillColor == 'buff', 0, 
ifelse(mushroom.muestra$GillColor == 'red', 1,
ifelse(mushroom.muestra$GillColor == 'gray', 2,
ifelse(mushroom.muestra$GillColor == 'chocolate',3,
ifelse(mushroom.muestra$GillColor == 'black',4, 
ifelse(mushroom.muestra$GillColor == 'brown', 5,
ifelse(mushroom.muestra$GillColor == 'orange', 6, 
ifelse(mushroom.muestra$GillColor == 'pink', 7,
ifelse(mushroom.muestra$GillColor == 'green', 8,
ifelse(mushroom.muestra$GillColor == 'purple', 9,
ifelse(mushroom.muestra$GillColor == 'white', 10, 
ifelse(mushroom.muestra$GillColor == 'yellow', 11, NA))))))))))))

mushroom.muestra |> descr(GillColor.numeric)
```

```{r}
tabla_frecuencias_gillcolor <- mushroom.muestra %>%
  count(GillColor.numeric) %>%
  mutate(f = n / nrow(mushroom.muestra))

tabla_frecuencias_gillcolor <- tabla_frecuencias_gillcolor %>%
  mutate(intervalo = cut(GillColor.numeric, breaks = pretty(GillColor.numeric, n = 10), right = FALSE)) %>%
  group_by(intervalo) %>%
  summarise(n = sum(n), 
            f = sum(f))

tabla_frecuencias_gillcolor <- tabla_frecuencias_gillcolor %>%
  mutate(N = cumsum(n),
         F = cumsum(f))

tabla_frecuencias_ordenada4 <- tabla_frecuencias_gillcolor %>%
  arrange(intervalo)

print(tabla_frecuencias_ordenada4)

```

Representacion de `GillColor.numeri` repecto a su frecuencia
```{r}
ggplot(data = mushroom.muestra) +
  geom_histogram(mapping = aes(x = GillColor.numeric), binwidth = 1) +
  geom_bar(fill = "gold3") 
```

Si representamos su densidad tenemos la siguiente gráfica:
```{r}
ggplot(mushroom.muestra, aes(x = GillColor.numeric)) +
geom_density() +
ggtitle('Color de la muestra de Mushroom')
```

Ahora representamos su distribución.
```{r}
ggplot(data = mushroom.muestra) +
  geom_histogram(mapping = aes(x = log(GillColor.numeric)), binwidth = .1)
```
