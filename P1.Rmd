---
title: "P1-Inferencia"
author: "Nuria Oviedo, Marcos Lopez Garc칤a"
date: "2024-10-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Ejercicio 1
```{r Librerias, message=FALSE, include = FALSE}
library(arulesCBA)
library(ggplot2)
library(summarytools)
library(tidyverse)
library(knitr)
```

```{r Importar datos, include = FALSE}
data("Mushroom")
```


Importamos los datos y mostramos los primeros y 칰ltimos datos en nuestra muestra para familiarizarnos con ellos.

```{r}
head(Mushroom)
```

```{r}
tail(Mushroom)
```


## Tama침o de los datos
```{r}
size <- dim(Mushroom)
n_obs <- size[1]
n_var <- size[2]
```
Este dataset, est치 compuesto de `r n_obs` observaciones y `r n_var` variables.

## Muestra del data set
Dado que tenemos un dataset con m치s de 1000 observaciones, hay que coger una muestra para hacer el an치lisis.

```{r}
set.seed(1234)
mushroom.muestra <- Mushroom[sample(1:n_obs, 1000, TRUE), ]
```

La muestra del dataset Mushroom es la siguiente:

```{r}
head(mushroom.muestra)
```

```{r}
tail(mushroom.muestra)
```


## Tipo de variables
```{r}
# Varialbes discretas
var_discreta <- length(which(sapply(Mushroom, class) == 'factor'))

# Variables continuas
var_continuas <- length(which(sapply(Mushroom, class) != 'factor'))

# Categor칤as de las variables
lapply(Mushroom, function(x) if(is.factor(x) | is.character(x)) unique(as.character(x)) else NULL)

# Variables tipo texto
i = 0
for (var in sapply(Mushroom, is.character)){
  if (var == TRUE){
    i = i + 1
  }
} 
```

Estudiando el tipo de variables que tiene este dataset, sabemos que hay `r var_discreta` variables discretas y `r var_continuas` variables continuas. De todas estas variables hay `r i` variables tipo texto.


## Variables irrelevantes
```{r echo = FALSE}
summary(Mushroom)
```

# Ejercicio 2
```{r}
summary(mushroom.muestra)
```

Dado que no hay variables continuas y todas son de tipo factor, solo podemos saber la fecuencia de la muestra:
```{r}
freq(mushroom.muestra)
```

Sin embargo hay varias varialbes que se pueden volver continuas. Como `RingNumber`o `RintType`. Tambien pueden ser booleanas como `Bruises`.
```{r}
mushroom.muestra$RingNumber.Numeric <- ifelse(mushroom.muestra$RingNumber == 'none', 0, 
                                       ifelse(mushroom.muestra$RingNumber == 'one', 1,
                                       ifelse(mushroom.muestra$RingNumber == 'two', 2, NA)))

mushroom.muestra$RingType.Numeric <- ifelse(mushroom.muestra$RingType == 'none', 0, 
                                     ifelse(mushroom.muestra$RingType == 'evanesent', 1,
                                     ifelse(mushroom.muestra$RingType == 'flaring', 2,
                                     ifelse(mushroom.muestra$RingType == 'large',3,
                                     ifelse(mushroom.muestra$RingType == 'pendant',4, NA)))))

mushroom.muestra$Bruises.bool <- ifelse(mushroom.muestra$Bruises == 'no', FALSE, 
                                       ifelse(mushroom.muestra$Bruises == 'bruise', TRUE, NA))
summary(mushroom.muestra)

```


# Ejercicio 3
Vamos a estudiar la variable `Spore` del dataset.
```{r}
tabla_frecuencias_type <- mushroom.muestra |>
  count(Spore) |>
  mutate(f = n / nrow(mushroom.muestra), N = cumsum(n), F = cumsum(f))
tabla_frecuencias_ordenada3 <- tabla_frecuencias_type |>
  arrange(desc(n))
tabla_frecuencias_ordenada3$F <- cumsum(tabla_frecuencias_ordenada3$f)
tabla_frecuencias_ordenada3$N <- cumsum(tabla_frecuencias_ordenada3$n)
print(tabla_frecuencias_ordenada3)
```

Por la tabla de frecuencias se puede ver que el color `buff` es el m치s frecuente, con una fracuencia de 0,187.

Resentando su frecuencia relativa obtenemos la siguiente tabla:
```{r}
mushroom.muestra  |> group_by(Spore) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), Spore = reorder(Spore, -Frequency)) |> ggplot(aes(x = Spore, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gr치fico de barras con frecuencia relativa de Spore", x = "Color", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "olivedrab2", high = "burlywood3") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Se puede ver que el color `buff` tiene casi un 20% al igual que el color `pink`

```{r}
mushroom.muestra |>
  group_by(Spore) |>
  summarise(Frequency = n()) |>
  mutate(Spore = reorder(Spore, -Frequency)) |>
  ggplot(aes(x = Spore, y = Frequency)) +
  geom_bar(stat = "identity", aes(fill = Frequency)) +
  theme_bw() +
  labs(title = "Gr치fico de barras con frecuencia absoluta de Spore",
       x = "Color",
       y = "Frecuencia absoluta") +
  scale_fill_gradient("Frecuencia", low = "olivedrab2", high = "burlywood3") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Al representar la frecuecia absoluta obtenermos el mismo resultado pero en cantidades, casi 200 hongos del color `buff` y `pink`. 

```{r}
ggplot(data = mushroom.muestra) +
  geom_bar(mapping = aes(x = Spore))
```


# Ejercicio 4
Como no tenermos varaibles continuas, voy a pasar a caracter la vaeiable de `GillColor`, los n칰meros que van con los distintos colores no tiene ninguna relacion, estan puestos por orden.

```{r}
mushroom.muestra$GillColor.numeric <- ifelse(mushroom.muestra$GillColor == 'buff', 0, 
ifelse(mushroom.muestra$GillColor == 'red', 1,
ifelse(mushroom.muestra$GillColor == 'gray', 2,
ifelse(mushroom.muestra$GillColor == 'chocolate',3,
ifelse(mushroom.muestra$GillColor == 'black',4, 
ifelse(mushroom.muestra$GillColor == 'brown', 5,
ifelse(mushroom.muestra$GillColor == 'orange', 6, 
ifelse(mushroom.muestra$GillColor == 'pink', 7,
ifelse(mushroom.muestra$GillColor == 'green', 8,
ifelse(mushroom.muestra$GillColor == 'purple', 9,
ifelse(mushroom.muestra$GillColor == 'white', 10, 
ifelse(mushroom.muestra$GillColor == 'yellow', 11, NA))))))))))))

mushroom.muestra |> descr(GillColor.numeric)
```

```{r}
tabla_frecuencias_gillcolor <- mushroom.muestra %>%
  count(GillColor.numeric) %>%
  mutate(f = n / nrow(mushroom.muestra))

tabla_frecuencias_gillcolor <- tabla_frecuencias_gillcolor %>%
  mutate(intervalo = cut(GillColor.numeric, breaks = pretty(GillColor.numeric, n = 10), right = FALSE)) %>%
  group_by(intervalo) %>%
  summarise(n = sum(n), 
            f = sum(f))

tabla_frecuencias_gillcolor <- tabla_frecuencias_gillcolor %>%
  mutate(N = cumsum(n),
         F = cumsum(f))

tabla_frecuencias_ordenada4 <- tabla_frecuencias_gillcolor %>%
  arrange(intervalo)

print(tabla_frecuencias_ordenada4)

```

Representacion de `GillColor.numeri` repecto a su frecuencia
```{r}
ggplot(data = mushroom.muestra) +
  geom_histogram(mapping = aes(x = GillColor.numeric), binwidth = 1) 
```

Si representamos su densidad tenemos la siguiente gr치fica:
```{r}
ggplot(mushroom.muestra, aes(x = GillColor.numeric)) +
geom_density() +
ggtitle('Color de la muestra de Mushroom')
```

Ahora representamos su distribuci칩n.
```{r}
ggplot(data = mushroom.muestra) +
  geom_histogram(mapping = aes(x = log(GillColor.numeric)), binwidth = .1)
```


# Ejercicio 5

```{r}

mushroom_filtrado <- mushroom.muestra %>%
  filter(GillColor.numeric > 0) # Filtrar las observaciones con valores cero en `GillColor.numeric`

# transformaci칩n logar칤tmica
mushroom_filtrado$GillColor.log <- log(mushroom_filtrado$GillColor.numeric)

# EMV de la media y desviaci칩n est치ndar
emv_media_log <- mean(mushroom_filtrado$GillColor.log)
emv_desv_log <- sd(mushroom_filtrado$GillColor.log)

print(paste("Estimador de m치xima verosimilitud de la media (EMV) de log(GillColor.numeric):", emv_media_log))
print(paste("Desviaci칩n est치ndar de log(GillColor.numeric):", emv_desv_log))

```


Antes de obtener el EVM, filtramos valores nulos de nuestros datos ya que no representan una parte relevante de la muestra  y mantenemos la integridad de nuestra muestra sin modificar los valores. 


```{r}

# Comparaci칩n gr치fica

ggplot(mushroom_filtrado, aes(x = GillColor.log)) +
  geom_histogram(aes(y = ..density..), binwidth = 0.1, fill = "lightgreen", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = emv_media_log, sd = emv_desv_log))+
  xlab("log(GillColor.numeric)") +
  ylab("Densidad")

```

Este histograma muestra la distribucion de la variable "GillColor.numeric".
La curva negra superpuesta al histograma es una estimaci칩n de la densidad de probabilidad de la distribuci칩n de la variable transformada y nos permite estimar la probabilidad de que la variable tome  un valor determinado.


# Ejercicio 6

```{r}

mushroom_filtrado <- mushroom.muestra %>%
  filter(GillColor.numeric > 0)

#transformaci칩n logar칤tmica
mushroom_filtrado$GillColor.log <- log(mushroom_filtrado$GillColor.numeric)

#media y varianza de la muestra con el m칠todo de los momentos
mom_media_log <- mean(mushroom_filtrado$GillColor.log)  # Media muestral
mom_varianza_log <- var(mushroom_filtrado$GillColor.log) #Varianza muestral

print(paste("Estimador de la media (Momento 1) de log(GillColor.numeric):", mom_media_log))
print(paste("Estimador de la varianza (Momento 2) de log(GillColor.numeric):", mom_varianza_log))

```


Como podemos observar, nuestro estimador de la media 洧랞es igual a 1.7048, este valor es obtenido tras aplicar la transformacion logaritmica por lo que en nuesra escala original tendr칤an un valor medio de 4,93.

Nuestro estimador de varianza 픢^2 es igual a 0.3053. Este valor mide la dispersion de los datos, al no ser elevado, nos sugiere que nuestros datos est치n cerca de la media.



```{r}

n <- nrow(mushroom_filtrado) # Calculamos tama침o de la muestra

# Nivel de confianza del 95%
z <- qnorm(0.975)

# intervalo de confianza
error_estandar <- sqrt(mom_varianza_log) / sqrt(n)
ic_lower <- mom_media_log - z * error_estandar
ic_upper <- mom_media_log + z * error_estandar

print(paste("Intervalo de confianza del 95% para la media:", round(ic_lower, 3), "a", round(ic_upper, 3)))

```

Este resultado nos indica que estamos al 95% seguros de que la media de nuestros valores tras la transformacion logar칤tmica se encuentra entre 1.667 y 1.743
Para tranformarlos a escala real solo tendr칤amos que deshacer el logaritmo ( e^1.667 = 5.30 y e^1.743 = 5.70) lo que significa que estamos al 95% seguros de que la media se encuentra entre 5.3 y 5.7
En este caso observamos que el intervalo [5.3 , 5.7] es estrecho por lo que tenemos una buena estimaci칩n de la media.

# Ejercicio 8

Teniendo `GillColor.numeric` como variabe continua, se va a representar en base al `habitat` en el que se encuenta cada tipo de hongo.

```{r}
ggplot(mushroom.muestra, aes(x = log(GillColor.numeric), colour = Habitat)) +
  geom_density(lwd=2, linetype=1)
```

Relacion entre estas dos variables.
```{r}
df = mushroom.muestra %>% 
      select(GillColor.numeric,Habitat)%>%
      mutate(log.GillColor.numeric=log(GillColor.numeric))
```

Comparando sus boxplots obtenemos
```{r}
ggplot(df, aes(Habitat, log.GillColor.numeric)) +
        geom_boxplot()
```

Tabla de frecuencias
```{r}
kable(table(mushroom.muestra$GillColor.numeric, mushroom.muestra$Habitat))

kable(prop.table(table(mushroom.muestra$GillColor.numeric, mushroom.muestra$Habitat)), digits = 6)
```

Datos sobre el conjunto de las dos variables
```{r}
lineal_1 <- mushroom.muestra |> 
  select(GillColor.numeric, Habitat) |> 
  with(lm(GillColor.numeric ~ Habitat))  
summary(lineal_1)
```
